import os
import textwrap
import socket
import http.server
import socketserver
import threading
import webbrowser
from datetime import datetime

BASE_DIR = "thewebsitebuildingAI"
ENTER_DIR = os.path.join(BASE_DIR, "ENTER_SITE")
STATIC_DIR = os.path.join(ENTER_DIR, "static")
GENERATED_DIR = os.path.join(BASE_DIR, "GENERATED_FROM_WEB")
LOG_FILE = os.path.join(BASE_DIR, "server_log.txt")

os.makedirs(STATIC_DIR, exist_ok=True)
os.makedirs(GENERATED_DIR, exist_ok=True)

index_html = """
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Website Building AI</title>
<link rel="stylesheet" href="static/style.css">
<script defer src="static/ai.js"></script>
</head>
<body>

<header class="card">
<h1>The Website Building AI</h1>
<p>thewebsitebuildingAI.com</p>
<p id="serverIp"></p>
</header>

<main>

<section class="card">
<h2>AI Website Code Generator</h2>
<textarea id="prompt" placeholder="Describe the website you want..."></textarea>
<button onclick="generateCode()">Generate FULL Website</button>
</section>

<section class="card">
<h2>Preview</h2>
<iframe id="preview"></iframe>
</section>

<section class="card">
<h2>Add Image</h2>
<input type="file" accept="image/*" onchange="loadImage(event)">
<img id="imgPreview">
</section>

<section class="card">
<h2>Add Video</h2>
<input type="file" accept="video/*" onchange="loadVideo(event)">
<video id="vidPreview" controls></video>
</section>

<section class="card">
<h2>Link</h2>
<input id="linkBox">
<button onclick="copyLink()">Copy</button>
</section>

</main>

<footer>
<p>© 2026 thewebsitebuildingAI.com</p>
</footer>

</body>
</html>
"""

style_css = """
*{box-sizing:border-box;font-family:Arial,sans-serif;}
body{margin:0;background:linear-gradient(145deg,#020617,#020617);color:white;perspective:1200px;}
header,footer{text-align:center;padding:30px;}
main{max-width:1100px;margin:auto;padding:30px;}
.card{background:#020617;border-radius:20px;padding:25px;margin-bottom:50px;
box-shadow:0 20px 40px rgba(0,0,0,.7);transition:transform .3s ease;}
.card:hover{transform:translateY(-6px) rotateX(2deg);}
textarea,input,button,iframe{width:100%;margin-top:12px;padding:14px;border-radius:12px;border:none;}
textarea{min-height:160px;background:#0f172a;color:white;}
button{background:#38bdf8;color:black;font-weight:bold;cursor:pointer;}
iframe{height:300px;background:white;}
img,video{width:100%;max-height:320px;margin-top:15px;border-radius:14px;}
"""

ai_js = """
window.onload=()=>{
const ip=window.location.hostname;
document.getElementById("serverIp").textContent="Server IP: "+ip;
document.getElementById("linkBox").value="http://"+ip+":8000";
};

function generateCode(){
const text=document.getElementById("prompt").value||"My Website";

const html=`
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${text}</title>
<style>
body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
flex-direction:column;
}
</style>
</head>
<body>
<h1>${text}</h1>
<p>Generated by thewebsitebuildingAI.com</p>
</body>
</html>
`;

document.getElementById("preview").srcdoc=html;

const blob=new Blob([html],{type:"text/html"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="generated_website.html";
a.click();

fetch("/save",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({html:html})
});
}

function loadImage(e){
document.getElementById("imgPreview").src=URL.createObjectURL(e.target.files[0]);
}

function loadVideo(e){
const v=document.getElementById("vidPreview");
v.src=URL.createObjectURL(e.target.files[0]);
v.load();
}

function copyLink(){
navigator.clipboard.writeText(document.getElementById("linkBox").value);
}
"""

open(os.path.join(ENTER_DIR,"index.html"),"w").write(textwrap.dedent(index_html))
open(os.path.join(STATIC_DIR,"style.css"),"w").write(textwrap.dedent(style_css))
open(os.path.join(STATIC_DIR,"ai.js"),"w").write(textwrap.dedent(ai_js))

PORT = 8000
hostname = socket.gethostname()
ip = socket.gethostbyname(hostname)

with open(LOG_FILE,"a") as log:
    log.write(f"{datetime.now()} {ip}:{PORT}\n")

class Handler(http.server.SimpleHTTPRequestHandler):
    def __init__(self,*args,**kwargs):
        super().__init__(*args,directory=ENTER_DIR,**kwargs)

    def do_POST(self):
        if self.path == "/save":
            length = int(self.headers.get("Content-Length", 0))
            data = self.rfile.read(length).decode()
            name = f"site_{int(datetime.now().timestamp())}.html"
            path = os.path.join(GENERATED_DIR, name)
            with open(path,"w",encoding="utf-8") as f:
                f.write(eval(data)["html"])
            self.send_response(200)
            self.end_headers()
        else:
            self.send_response(404)
            self.end_headers()

def start_server():
    with socketserver.TCPServer(("",PORT),Handler) as httpd:
        httpd.serve_forever()

if __name__ == "__main__":
    threading.Thread(target=start_server,daemon=True).start()
    webbrowser.open(f"http://{ip}:{PORT}")
thewebsitebuildingAI/
│
├─ run.py
│
├─ ENTER_SITE/
│   ├─ index.html
│   └─ static/
│       ├─ style.css
│       └─ ai.js
